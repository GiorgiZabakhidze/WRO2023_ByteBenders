#pragma config(Sensor, S1,     usonic,         sensorEV3_Ultrasonic)
#pragma config(Sensor, S2,     gyro,           sensorEV3_Gyro)
#pragma config(Sensor, S3,     color2,         sensorEV3_Color)
#pragma config(Sensor, S4,     color1,         sensorEV3_Color)
#pragma config(Motor,  motorA,          claw,          tmotorEV3_Medium, PIDControl, encoder)
#pragma config(Motor,  motorB,          wheelR,        tmotorEV3_Medium, PIDControl, encoder)
#pragma config(Motor,  motorC,          wheelL,        tmotorEV3_Medium, PIDControl, reversed, encoder)
#pragma config(Motor,  motorD,          hand,          tmotorEV3_Large, PIDControl, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

// color1 - LineFollower-is Sensor-i
// color2 - ColorCheck-is Sensor-i

//float lineCorrectionTime = 1000;

#include "AlgorithmTypeFunctions.c"
#include "PID.c"
#include "PID_Usage.c"
#include "PID_tasks.c"
#include "PID_Start.c"
#include "PID_LineFollower.c"
#include "PID_Gyro.c"
#include "PID_Hand&Claw.c"
#include "Functions.c"
#include "PID_highLevelFunctions.c"
#include "Initialization.c"

PID LineFollower_normal_r;
PID LineFollower_normal_l;
PID Gyro_rotate;
PID Hand_normal;
PID Claw_normal;
PID Gyro_mover;

int color2Color = 0;

#include "Tasks.c"

void moveBy(int by)
{
	int target = getMotorEncoder(wheelR) + MmToEncoder(by);

	while(getMotorEncoder(wheelR) < target)
	{
		setMotorSpeed(wheelR, 30);
		setMotorSpeed(wheelL, 30);
	}
	setMotorSpeed(wheelR, 0);
	setMotorSpeed(wheelL, 0);
}

task main()
{
	Initializate();

	PID_init(&LineFollower_normal_r, 0.31, 0.0005, 0.0009, 0.000666666, 80, -80, 45, 20);
	PID_init(&LineFollower_normal_l, 0.5, 0.02, 0.0009, 0.000666666, 80, -80, 52, 30);
	PID_init(&Gyro_rotate, 1.5, 0.001, 0, 0.000666666, 80, -80, 0, 0);
	PID_init(&Gyro_mover, 2, 0.0, 0.000, 0.000666666, 80, -80, 0, 20);
	PID_init(&Hand_normal, 1, 0.09, 0.023, 0.00043, 80, -80, 0, 0);
	PID_init(&Claw_normal, 3, 0.0, 0.0, 0.00043, 80, -80, 0, 0);

	LineFollower_normal_r.lineCorrectionTime = 500;
	LineFollower_normal_l.lineCorrectionTime = 1500;

	Gyro_rotate.acceptableRange = 0;

	Gyro_rotate.oneSided = true;
	Gyro_rotate.side = true;

	PID_Gyro_Rotate(Gyro_rotate, -90);

	while(task_usage[2].use != none){}

	Gyro_rotate.oneSided = true;
	Gyro_rotate.side = false;

	PID_Gyro_Rotate(Gyro_rotate, -35);

	while(task_usage[2].use != none){}

	Gyro_rotate.oneSided = true;
	Gyro_rotate.side = true;

	PID_Gyro_Rotate(Gyro_rotate, -55);

	while(task_usage[2].use != none){}

	Gyro_rotate.oneSided = false;
	Gyro_rotate.side = true;

	Gyro_rotate.acceptableRange = 2;

	PID_Gyro_Rotate(Gyro_rotate, 30);

	while(task_usage[1].use != none){}

	moveBy(30);

	Gyro_rotate.oneSided = true;
	Gyro_rotate.side = true;

	PID_Gyro_Rotate(Gyro_rotate, -32);

	while(task_usage[2].use != none){}

	moveBy(400);
	while(1){}
}
